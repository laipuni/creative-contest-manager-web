<configuration debug="true">
    <!-- ë¡œê·¸ë°± ë‚´ë¶€ ë””ë²„ê¹… í™œì„±í™” -->
    <statusListener class="ch.qos.logback.core.status.OnConsoleStatusListener" />

    <springProperty scope="context" name="SPRING_MAIL_USERNAME" source="spring.mail.username"/>
    <springProperty scope="context" name="SPRING_MAIL_PASSWORD" source="spring.mail.password"/>

    <!-- Logstashë¡œ ì „ì†¡í•  Appender -->
    <appender name="LOGSTASH" class="net.logstash.logback.appender.LogstashTcpSocketAppender">
        <destination>logstash:5044</destination>
        <encoder class="net.logstash.logback.encoder.LogstashEncoder" />
    </appender>

    <!-- ì½˜ì†” ì¶œë ¥ -->
    <appender name="CONSOLE" class="ch.qos.logback.core.ConsoleAppender">
        <encoder>
            <pattern>%d{yyyy-MM-dd HH:mm:ss} %-5level [%thread] %logger{36} - %msg%n</pattern>
        </encoder>
    </appender>

    <!-- íŒŒì¼ ì¶œë ¥ -->
    <appender name="FILE" class="ch.qos.logback.core.rolling.RollingFileAppender">
        <file>application.log</file>
        <rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">
            <fileNamePattern>application.%d{yyyy-MM-dd}.log.gz</fileNamePattern>
            <maxHistory>5</maxHistory>
        </rollingPolicy>
        <encoder>
            <pattern>%d{yyyy-MM-dd HH:mm:ss} %-5level [%thread] %logger{36} - %msg%n</pattern>
        </encoder>
    </appender>

    <appender name="EMAIL" class="ch.qos.logback.classic.net.SMTPAppender">
        <smtpHost>smtp.gmail.com</smtpHost>
        <smtpPort>587</smtpPort>
        <username>${SPRING_MAIL_USERNAME}</username>
        <password>${SPRING_MAIL_PASSWORD}</password>
        <to>${SPRING_MAIL_USERNAME}</to>
        <from>${SPRING_MAIL_USERNAME}</from>
        <subject>ðŸš¨ [ERROR] Time to work! ðŸš¨</subject>

        <!-- STARTTLS ì„¤ì • ê°œì„  -->
        <STARTTLS>true</STARTTLS>
        <SSL>false</SSL>

        <!-- Gmail ì¸ì¦ ì„¤ì • ì¶”ê°€ -->
        <sessionViaJNDI>false</sessionViaJNDI>
        <authenticator class="ch.qos.logback.classic.net.DefaultAuthenticator">
            <username>${SPRING_MAIL_USERNAME}</username>
            <password>${SPRING_MAIL_PASSWORD}</password>
        </authenticator>

        <!-- ì¶”ê°€ SMTP í”„ë¡œí¼í‹° -->
        <smtpProperty name="mail.smtp.auth">true</smtpProperty>
        <smtpProperty name="mail.smtp.starttls.enable">true</smtpProperty>
        <smtpProperty name="mail.smtp.starttls.required">true</smtpProperty>
        <smtpProperty name="mail.smtp.ssl.protocols">TLSv1.2</smtpProperty>

        <layout class="ch.qos.logback.classic.PatternLayout">
            <pattern>%d{yyyy-MM-dd HH:mm:ss} %-5level [%thread] %logger{36} - %msg%n</pattern>
        </layout>

        <filter class="ch.qos.logback.classic.filter.ThresholdFilter">
            <level>ERROR</level>
        </filter>

<!--        &lt;!&ndash; ì´ë©”ì¼ ì „ì†¡ ì‹¤íŒ¨ ì‹œ ìž¬ì‹œë„ ë°©ì§€ &ndash;&gt;-->
<!--        <cyclicBufferTracker class="ch.qos.logback.core.spi.CyclicBufferTracker">-->
<!--            <bufferSize>1</bufferSize>-->
<!--        </cyclicBufferTracker>-->
    </appender>

    <!--localì—ì„œëŠ” ì½˜ì†”, ë””ë²„ê¹… ë ˆë²¨ì€ debug ë¶€í„°-->
    <springProfile name="local">
        <root level="debug">
            <appender-ref ref="CONSOLE"/>
<!--            <appender-ref ref="FILE"/>-->
<!--            <appender-ref ref="EMAIL"/>-->
        </root>
    </springProfile>

    <!--ìš´ì˜ í™˜ê²½ì—ì„œëŠ” ì½˜ì†”, íŒŒì¼, ë””ë²„ê¹… ë ˆë²¨ì€ info ë¶€í„°-->
    <springProfile name="prod">
        <root level="info">
            <appender-ref ref="CONSOLE"/>
            <appender-ref ref="FILE"/>
<!--            <appender-ref ref="LOGSTASH"/>-->
            <appender-ref ref="EMAIL"/>
        </root>
    </springProfile>
</configuration>